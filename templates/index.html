<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YouTube Transcript Summarizer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: '#8b5cf6',
                        'primary-glow': '#a78bfa',
                        success: '#10b981',
                        warning: '#f59e0b',
                        destructive: '#ef4444'
                    },
                    animation: {
                        'glow': 'glow 2s ease-in-out infinite alternate',
                        'float': 'float 3s ease-in-out infinite',
                        'spin': 'spin 1s linear infinite'
                    }
                }
            }
        }
    </script>
    <style>
        @keyframes glow {
            from { box-shadow: 0 0 20px rgba(139, 92, 246, 0.3); }
            to { box-shadow: 0 0 40px rgba(139, 92, 246, 0.6); }
        }
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }
        body {
            background: linear-gradient(135deg, #0f0f23 0%, #1a1a2e 50%, #16213e 100%);
        }
        .glass-effect {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .gradient-primary {
            background: linear-gradient(135deg, #8b5cf6, #a78bfa);
        }
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        select {
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            background-color: #ffffff; /* Explicitly set light background */
            color: #333; /* Explicitly set dark text */
            border: 2px solid #e1e5e9; /* Ensure border is consistent */
            color-scheme: light; /* Hint to browser to use light-themed dropdown options */
            background-image: url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%23667eea%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-12.9%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2012.9l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095c3.5-3.5%205.4-7.8%205.4-12.8%200-5-1.9-9.4-5.4-12.8z%22/%3E%3C/svg%3E');
            background-repeat: no-repeat;
            background-position: right .7em top 50%;
            background-size: .65em auto;
            padding-right: 2.5em; /* Make space for the arrow */
        }
        select option {
            background: white;
            color: black;
        }
        textarea { 
            min-height: 120px; 
        }
    </style>
</head>
<body class="min-h-screen text-white">
    <div class="min-h-screen py-8 px-4">
        <div class="max-w-4xl mx-auto space-y-8">
            <!-- Header -->
            <div class="text-center space-y-4">
                <div class="flex items-center justify-center gap-3 mb-4">
                    <div class="p-3 rounded-full gradient-primary animate-glow">
                        <svg class="h-8 w-8 text-white" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"/>
                        </svg>
                    </div>
                    <h1 class="text-4xl font-bold bg-gradient-to-r from-primary to-primary-glow bg-clip-text text-transparent">
                        YouTube Transcript Summarizer
                    </h1>
                </div>
                <p class="text-gray-300 text-lg max-w-2xl mx-auto">
                    Extract transcripts from YouTube videos and generate intelligent summaries with AI
                </p>
            </div>

            <!-- URL Input Card -->
            <div class="glass-effect rounded-lg p-6 shadow-lg">
                <div class="space-y-4">
                    <div class="flex items-center gap-2 mb-4">
                        <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m21 21-6-6m2-5a7 7 0 1 1-14 0 7 7 0 0 1 14 0z"/>
                        </svg>
                        <h2 class="text-xl font-semibold">Enter YouTube URL</h2>
                    </div>
                    <p class="text-gray-400 text-sm mb-4">Paste a YouTube URL or video ID to get started</p>
                    <div class="flex gap-3">
                        <input 
                            type="text" 
                            id="ytUrl" 
                            placeholder="https://youtu.be/VIDEO_ID or just VIDEO_ID"
                            class="flex-1 px-4 py-3 rounded-lg bg-white/10 border border-white/20 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent transition-all"
                        />
                        <button 
                            onclick="getAvailableTranscripts()" 
                            id="getTranscriptsBtn"
                            class="px-6 py-3 gradient-primary rounded-lg font-semibold hover:shadow-lg hover:-translate-y-0.5 transition-all duration-300 flex items-center gap-2"
                        >
                            <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m21 21-6-6m2-5a7 7 0 1 1-14 0 7 7 0 0 1 14 0z"/>
                            </svg>
                            Get Transcripts
                        </button>
                    </div>
                </div>
            </div>

            <!-- Loading State -->
            <div id="loading" class="text-center py-8 hidden">
                <div class="inline-flex items-center gap-3">
                    <svg class="animate-spin h-6 w-6 text-primary" fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                    <span class="text-primary font-semibold">Testing available languages... This may take a moment.</span>
                </div>
            </div>

            <!-- Status Messages -->
            <div id="error" class="hidden p-4 rounded-lg bg-red-500/10 border border-red-500/20 text-red-300">
                <div class="flex items-center gap-2">
                    <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                    </svg>
                    <span id="error-message"></span>
                </div>
            </div>

            <div id="success" class="hidden p-4 rounded-lg bg-green-500/10 border border-green-500/20 text-green-300">
                <div class="flex items-center gap-2">
                    <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                    </svg>
                    <span id="success-message"></span>
                </div>
            </div>

            <!-- Video Info Card -->
            <div id="video-info" class="glass-effect rounded-lg p-6 shadow-lg hidden">
                <div class="flex flex-col lg:flex-row gap-6">
                    <div class="lg:w-1/3">
                        <img id="thumbnail" class="w-full rounded-lg shadow-lg hover:shadow-xl transition-all duration-300 animate-float" />
                    </div>
                    <div class="lg:w-2/3 space-y-4">
                        <h3 id="video-title" class="text-xl font-semibold leading-relaxed"></h3>
                        <div class="flex items-center gap-2">
                            <svg class="h-4 w-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5h12M9 3v2m1.048 9.5A18.022 18.022 0 016.412 9m6.088 9h7M11 21l5-10 5 10M12.751 5C11.783 10.77 8.07 15.61 3 18.129"/>
                            </svg>
                            <span id="language-count" class="text-sm text-gray-400"></span>
                        </div>
                        <div id="language-badges" class="flex flex-wrap gap-2"></div>
                    </div>
                </div>
            </div>

            <!-- Language Selection -->
            <div id="language-selection" class="glass-effect rounded-lg p-6 shadow-lg hidden">
                <div class="space-y-4">
                    <div class="flex items-center gap-2 mb-4">
                        <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2H5a2 2 0 00-2-2z"/>
                        </svg>
                        <h2 class="text-xl font-semibold">Select Language & Get Transcript</h2>
                    </div>
                    <select id="languageSelect" class="w-full px-4 py-3 rounded-lg bg-white/10 border border-white/20 text-white focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
                        <option value="">Choose a language...</option>
                    </select>
                    <button 
                        onclick="fetchTranscript()" 
                        id="fetchTranscriptBtn"
                        class="w-full px-6 py-3 bg-white/10 border border-white/20 rounded-lg font-semibold hover:bg-white/20 hover:-translate-y-0.5 transition-all duration-300 flex items-center justify-center gap-2"
                        disabled
                    >
                        <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                        </svg>
                        Get Transcript
                    </button>
                </div>
            </div>

            <!-- Transcript Display -->
            <div id="transcript-section" class="glass-effect rounded-lg p-6 shadow-lg hidden">
                <div class="space-y-4">
                    <div class="flex items-center gap-2 mb-4">
                        <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                        </svg>
                        <h2 class="text-xl font-semibold">Transcript</h2>
                    </div>
                    <textarea 
                        id="transcript" 
                        readonly 
                        class="w-full min-h-[200px] px-4 py-3 rounded-lg bg-white/5 border border-white/20 text-white placeholder-gray-400 font-mono text-sm resize-none focus:outline-none"
                        placeholder="Transcript will appear here..."
                    ></textarea>
                </div>
            </div>

            <!-- Summary Controls -->
            <div id="summary-controls" class="glass-effect rounded-lg p-6 shadow-lg hidden">
                <div class="space-y-4">
                    <div class="flex items-center gap-2 mb-4">
                        <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z"/>
                        </svg>
                        <h2 class="text-xl font-semibold">Generate Summary</h2>
                    </div>
                    <p class="text-gray-400 text-sm mb-4">Choose your preferred language for the AI-generated summary</p>
                    <select id="summaryLanguageSelect" class="w-full px-4 py-3 rounded-lg bg-white/10 border border-white/20 text-white focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent mb-4">
                        <option value="en">English</option>
                        <option value="de">German (Deutsch)</option>
                        <option value="fr">French (Français)</option>
                        <option value="es">Spanish (Español)</option>
                        <option value="ja">Japanese (日本語)</option>
                        <option value="ko">Korean (한국어)</option>
                        <option value="original">Same as transcript</option>
                    </select>
                    <button 
                        onclick="generateSummary()" 
                        id="generateSummaryBtn"
                        class="w-full px-6 py-3 gradient-primary rounded-lg font-semibold hover:shadow-lg hover:-translate-y-0.5 transition-all duration-300 flex items-center justify-center gap-2"
                    >
                        <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z"/>
                        </svg>
                        Generate Summary
                    </button>
                </div>
            </div>

            <!-- Summary Display -->
            <div id="summary-section" class="glass-effect rounded-lg p-6 shadow-lg hidden">
                <div class="space-y-4">
                    <div class="flex items-center gap-2 mb-4">
                        <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z"/>
                        </svg>
                        <h2 class="text-xl font-semibold">AI Summary</h2>
                    </div>
                    <textarea 
                        id="summary" 
                        readonly 
                        class="w-full min-h-[200px] px-4 py-3 rounded-lg bg-white/5 border border-white/20 text-white placeholder-gray-400 resize-none focus:outline-none"
                        placeholder="Summary will appear here..."
                    ></textarea>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentVideoData = null;

        function resetUI() {
            ['error', 'success', 'loading', 'video-info', 'language-selection', 
             'transcript-section', 'summary-section', 'summary-controls'].forEach(id => {
                document.getElementById(id).classList.add('hidden');
            });
            
            document.getElementById('transcript').value = '';
            document.getElementById('summary').value = '';
            document.getElementById('languageSelect').innerHTML = '<option value="">Choose a language...</option>';
        }

        function showError(message) {
            const errorDiv = document.getElementById('error');
            document.getElementById('error-message').textContent = message;
            errorDiv.classList.remove('hidden');
            document.getElementById('success').classList.add('hidden');
        }

        function showSuccess(message) {
            const successDiv = document.getElementById('success');
            document.getElementById('success-message').textContent = message;
            successDiv.classList.remove('hidden');
            document.getElementById('error').classList.add('hidden');
        }

        async function getAvailableTranscripts() {
            resetUI();
            
            const url = document.getElementById('ytUrl').value.trim();
            if (!url) {
                showError('Please enter a YouTube URL or Video ID.');
                return;
            }
            
            document.getElementById('loading').classList.remove('hidden');
            document.getElementById('getTranscriptsBtn').disabled = true;
            
            try {
                const resp = await fetch('/get_transcripts', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ url })
                });
                
                const data = await resp.json();
                
                if (resp.status !== 200) {
                    showError(data.error || 'An unknown error occurred.');
                    return;
                }
                
                currentVideoData = data;
                
                // Show video info
                document.getElementById('thumbnail').src = data.thumbnail_url;
                document.getElementById('video-title').textContent = data.title;
                document.getElementById('language-count').textContent = 
                    `${data.available_transcripts.length} language${data.available_transcripts.length !== 1 ? 's' : ''} available`;
                
                // Show language badges
                const badgesContainer = document.getElementById('language-badges');
                badgesContainer.innerHTML = '';
                data.available_transcripts.slice(0, 6).forEach(transcript => {
                    const badge = document.createElement('span');
                    badge.className = 'px-2 py-1 text-xs rounded-full bg-white/10 border border-white/20';
                    badge.textContent = `${transcript.language} (${transcript.language_code})`;
                    badgesContainer.appendChild(badge);
                });
                
                if (data.available_transcripts.length > 6) {
                    const moreBadge = document.createElement('span');
                    moreBadge.className = 'px-2 py-1 text-xs rounded-full bg-white/10 border border-white/20';
                    moreBadge.textContent = `+${data.available_transcripts.length - 6} more`;
                    badgesContainer.appendChild(moreBadge);
                }
                
                // Populate language select
                const languageSelect = document.getElementById('languageSelect');
                languageSelect.innerHTML = '<option value="">Choose a language...</option>';
                data.available_transcripts.forEach(transcript => {
                    const option = document.createElement('option');
                    option.value = transcript.language_code;
                    option.textContent = `${transcript.language} (${transcript.language_code})`;
                    languageSelect.appendChild(option);
                });
                
                document.getElementById('video-info').classList.remove('hidden');
                document.getElementById('language-selection').classList.remove('hidden');
                showSuccess(`Found ${data.available_transcripts.length} working transcript(s)!`);
                
            } catch (e) {
                showError('Network error: ' + e.message);
            } finally {
                document.getElementById('loading').classList.add('hidden');
                document.getElementById('getTranscriptsBtn').disabled = false;
            }
        }
        
        async function fetchTranscript() {
            const languageCode = document.getElementById('languageSelect').value;
            if (!languageCode) {
                showError('Please select a language.');
                return;
            }
            
            const btn = document.getElementById('fetchTranscriptBtn');
            btn.disabled = true;
            btn.innerHTML = `
                <svg class="h-4 w-4 animate-spin" fill="none" viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
                Fetching transcript...
            `;
            
            try {
                const resp = await fetch('/transcript', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        url: document.getElementById('ytUrl').value,
                        language_code: languageCode 
                    })
                });
                
                const data = await resp.json();
                
                if (resp.status !== 200) {
                    showError(data.error || 'Failed to fetch transcript.');
                    return;
                }
                
                document.getElementById('transcript').value = data.transcript;
                document.getElementById('transcript-section').classList.remove('hidden');
                document.getElementById('summary-controls').classList.remove('hidden');
                showSuccess('Transcript fetched successfully! Ready to summarize.');
 
            } catch (e) {
                showError('Error: ' + e.message);
            } finally {
                btn.disabled = false;
                btn.innerHTML = `
                    <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                    </svg>
                    Get Transcript
                `;
            }
        }

        async function generateSummary() {
            const transcriptText = document.getElementById('transcript').value;
            if (!transcriptText) {
                showError('Please fetch a transcript first.');
                return;
            }

            let summaryLang = document.getElementById('summaryLanguageSelect').value;
            if (summaryLang === 'original') {
                summaryLang = document.getElementById('languageSelect').value;
            }

            const btn = document.getElementById('generateSummaryBtn');
            btn.disabled = true;
            btn.innerHTML = `
                <svg class="h-4 w-4 animate-spin" fill="none" viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
                Generating summary...
            `;

            try {
                const resp = await fetch('/summarize_stream', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        text: transcriptText,
                        summary_language: summaryLang 
                    })
                });

                if (resp.status !== 200) {
                    const errorData = await resp.json();
                    showError(errorData.error || 'Failed to start summary stream.');
                    return;
                }

                const reader = resp.body.getReader();
                const decoder = new TextDecoder();
                
                document.getElementById('summary-section').classList.remove('hidden');
                const summaryTextarea = document.getElementById('summary');
                summaryTextarea.value = '';

                while (true) {
                    const { value, done } = await reader.read();
                    if (done) break;
                    
                    const chunk = decoder.decode(value, { stream: true });
                    const lines = chunk.split('\n').filter(l => l.trim());
                    
                    for (const line of lines) {
                        try {
                            const obj = JSON.parse(line);
                            if (obj.summary_chunk) {
                                summaryTextarea.value += obj.summary_chunk;
                            } else if (obj.error) {
                                showError('An error occurred during summarization: ' + obj.error);
                            }
                        } catch (e) {
                            console.error("Failed to parse stream chunk:", line, e);
                        }
                    }
                }

                showSuccess('Summary generated successfully!');

            } catch (e) {
                showError('A network error occurred: ' + e.message);
            } finally {
                btn.disabled = false;
                btn.innerHTML = `
                    <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z"/>
                    </svg>
                    Generate Summary
                `;
            }
        }
        
        // Event Listeners
        document.getElementById('ytUrl').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                e.preventDefault();
                getAvailableTranscripts();
            }
        });
        
        document.getElementById('languageSelect').addEventListener('change', () => {
            const hasLanguage = !!document.getElementById('languageSelect').value;
            document.getElementById('fetchTranscriptBtn').disabled = !hasLanguage;
        });
    </script>
</body>
</html>
